<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8">

    <title>Wie man JavaScript schnell macht</title>

    <meta name="description" content="Wie man JavaScript schnell macht (oder die Illusion erweckt)">
    <meta name="author" content="Lukas Taegert">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="style/presentation.css">
    <script src="src/client/presentation.js"></script>
    <script src="src/client/custom.js"></script>
    <script src="src/client/async.js"></script>
</head>

<!--
  Wofür stehen die CSS-Klassen?
  charred: Charred-Trail-Plugin aktivieren,
  auto-fragment: alle <li> innerhalb von <ul> und <ol> in Fragments umwandeln, d.h. bei Tastendruck erst einblenden
-->
<body class="charred auto-fragment">

    <!-- Titel-Slide -->
    <section>
        <h3>Wie man</h3>
        <h1>JavaScript schnell</h1>
        <h3>macht (oder die Illusion erweckt)</h3>
        <p style="padding-top:5%">
            <a href="mailto:lukas.taegert@tngtech.com">Lukas Taegert</a>
        </p>
        <p>TechDay@Unterföhring, 2016-10-28</p>
        <a href="http://www.tngtech.com"><img class="logo" src="img/tng.svg"></a>
    </section>

    <!-- Inhalt ab hier, für eigene Präsentationen einfach löschen -->
    <!-- Gibt man data-title="foo" an, wird eine Übersichtseite mit Links hier in die Präsentation eingefügt -->
    <section data-title="Animation Frames">
        <section>
            <h1>Animation Frames</h1>
            <h3>60FPS ist das Maß der Dinge</h3>
        </section>
        <section>
            <h2>Was sind Animation Frames?</h2>
            <ul>
                <li class="fragment">Synchronisieren Funktionsaufrufe mit der Bildwiederholrate<br>("animation frame")</li>
                <li class="fragment">Angefordert mit <code>window.requestAnimationFrame(…)</code></li>
                <li class="fragment">Maximal 60 Animation Frames pro Sekunde</li>
                <li class="fragment">CSS Animationen benutzen die gleichen Frames</li>
            </ul>
        </section>
        <section>
            <p>Animation Frames werden</p>
            <h2>aggregiert</h2>
            <p>und als synchroner Block ausgeführt</p>
            <div class="fragment no-burn" data-fragment-index="1" style="width: 60%; display:inline-block"><pre><code class="hljs js"
                                                                                                                      id="aggregate-frames"
                                                                                                                      data-trim
                                                                                                                      contenteditable>
function printTimeStamp(timeStamp) {
    document.getElementById('agg-out')
        .textContent += timeStamp + '\n';
}

// Those all fire at the same time
requestAnimationFrame(printTimeStamp);
for (let i = 0; i < 1000; i++) {}
requestAnimationFrame(printTimeStamp);
requestAnimationFrame(printTimeStamp);
for (let i = 0; i < 1000; i++) {}
requestAnimationFrame(printTimeStamp);
            </code></pre>
            </div>
            <div class="fragment no-burn" data-fragment-index="1" style="width: 30%; display:inline-block; vertical-align: top">
                <pre><code data-trim id="agg-out" style="max-height: 15em; min-height: 1em"></code></pre>
            </div>
            <a class="fragment no-burn" data-fragment-index="1" style="display: block" onclick="return runCode('aggregate-frames')"
               href="#">Ausführen</a>
        </section>
        <section>
            <p>Messen der aktuellen Frame Rate mit einer</p>
            <h2>Animation Loop</h2>
            <div class="fragment no-burn" data-fragment-index="1" style="width: 65%; display:inline-block"><pre><code class="hljs js"
                                                                                                                      id="loop" data-trim
                                                                                                                      contenteditable>
var startTime = 0, counter = 0;

function measureFrameRate(timeStamp) {
    if (counter < 9) counter++;
    else {
        counter = 0;
        document.getElementById('loop-out')
            .textContent = 10000 /
            (timeStamp - startTime);
        startTime = timeStamp;
    }
    !isStopped &&
        requestAnimationFrame(measureFrameRate);
}

requestAnimationFrame(measureFrameRate);
            </code></pre>
            </div>
            <div class="fragment no-burn" data-fragment-index="1" style="width: 25%; display:inline-block; vertical-align: top">
                <pre><code data-trim id="loop-out" style="max-height: 15em; min-height: 1em"></code></pre>
            </div>
            <a class="fragment no-burn" data-fragment-index="1" style="display: inline-block; margin-right: 10%"
               onclick="window.isStopped = false; return runCode('loop')" href="#">Ausführen</a>
            <a class="fragment no-burn" data-fragment-index="1" style="display: inline-block"
               onclick="window.isStopped = true; return false" href="#">Stop</a>
        </section>
        <section>
            <p>
                Lange Berechnungen oder<br>
                Animation Frames, die<br>
                in der Summe länger als 16ms dauern
            </p>
            <h2>
                blockieren das UI
            </h2>
        </section>
    </section>

    <section data-title="Synchron wird asynchron">
        <section>
            <h3>Aus synchron mach</h3>
            <h1>asynchron</h1>
        </section>
        <section>
            <p>
                Braucht Dein Code
            </p>
            <h2>
                zu lange?
            </h2>
            <pre class="fragment no-burn" data-fragment-index="1" style="width:70%"><code class="hljs js" id="console-time" data-trim
                                                                                          contenteditable>
console.time('myTimer');

for (var i = 0; i < 100000; i++) {}

console.timeEnd('myTimer');
                </code></pre>
            <a class="fragment no-burn" data-fragment-index="1" style="display: inline-block" onclick="return runCode('console-time')"
               href="#">Ausführen</a>
        </section>
        <section>
            <p>Hilfreich zum Aufspalten langer Berechnungen:</p>
            <h2>
                <a href="http://caolan.github.io/async/"><img style="width: 30%" src="img/async-logo.svg"></a>
            </h2>
            <a href="http://caolan.github.io/async/">caolan.github.io/async</a>
            <p class="fragment">Sammlung von Tools, um verschiedenste Codestrukturen<br>asynchron zu machen</p>
        </section>
        <section>
            <p>Berechne Pi</p>
            <pre style="width: 75%"><code class="hljs js" id="better-pi" data-trim contenteditable>
var pi = 0, count = 1;

function makeBetterPi() {
    pi += 4 * Math.pow(-1, count + 1)/(2*count - 1);
    count++;
}
            </code></pre>
            <p class="fragment no-burn" data-fragment-index="1">synchron</p>
            <pre class="fragment no-burn" data-fragment-index="1" style="width: 75%"><code class="hljs js" id="pi-sync" data-trim
                                                                                           contenteditable>
while (count < 1000000) {
    makeBetterPi();
    document.getElementById('pi-sync-out').textContent = pi;
}
            </code></pre>
            <a class="fragment no-burn" data-fragment-index="1" style="display: inline-block; margin-right: 10%"
               onclick="return runCode('better-pi', 'pi-sync')" href="#">Ausführen</a>
            <div class="fragment no-burn" data-fragment-index="1" style="display: inline-block; width: 40%">
                <pre><code data-trim id="pi-sync-out">0</code></pre>
            </div>
        </section>
        <section>
            <p>Berechne Pi</p>
            <pre style="width: 75%"><code class="hljs js" id="better-pi2" data-trim contenteditable>
var pi = 0, count = 1;

function makeBetterPi() {
    pi += 4 * Math.pow(-1, count + 1)/(2*count - 1);
    count++;
}
            </code></pre>
            <p class="fragment no-burn" data-fragment-index="1">mit async</p>
            <pre class="fragment no-burn" data-fragment-index="1" style="width: 75%"><code class="hljs js" id="pi-async" data-trim
                                                                                           contenteditable>
async.timesSeries(1000, (n, done) => {
    do makeBetterPi();
    while (count % 1000 !== 0);
    document.getElementById('pi-async-out').textContent = pi;
    setTimeout(done, 0);
});
            </code></pre>
            <a class="fragment no-burn" data-fragment-index="1" style="display: inline-block; margin-right: 10%"
               onclick="return runCode('better-pi2', 'pi-async')" href="#">Ausführen</a>
            <div class="fragment no-burn" data-fragment-index="1" style="display: inline-block; width: 40%">
                <pre><code data-trim id="pi-async-out">0</code></pre>
            </div>
        </section>
        <section>
            <p>
                async sorgt für
            </p>
            <h2>flüssige Animationen</h2>
            <p class="fragment no-burn">aber</p>
            <h2 class="fragment no-burn">async verschwendet Zeit!</h2>
            <p class="fragment">Kann man das optimieren?</p>
        </section>
    </section>

    <section data-title="performance.now">
        <section>
            <h3>
                Messen, nicht glauben, mit
            </h3>
            <h1>
                performance.now
            </h1>
        </section>
        <section>
            <h2>performance.now()</h2>
            <ul>
                <li class="fragment no-burn">Liefert "high resolution time stamp": +/- 0.001ms</li>
                <li class="fragment">Date.now(): +/- 10ms</li>
                <li class="fragment">Timestamp ist relativ zum Programmstart</li>
                <li class="fragment">Verfügbar in allen modernen Browsern</li>
            </ul>
        </section>
        <section>
            <p>Nochmals Pi</p>
            <pre style="width: 75%"><code class="hljs js" id="better-pi3" data-trim contenteditable>
var pi = 0, count = 1;

function makeBetterPi() {
    pi += 4 * Math.pow(-1, count + 1)/(2*count - 1);
    count++;
}
            </code></pre>
            <p class="fragment no-burn" data-fragment-index="1">mit einer selbstoptimierenden Schleife</p>
            <pre class="fragment no-burn" data-fragment-index="1" style="width: 75%"><code class="hljs js" id="pi-opt" data-trim
                                                                                           contenteditable>
async.whilst(() => count < 1000000, done => {
    const startTime = performance.now();
    do makeBetterPi();
    while (performance.now() - startTime < 5);
    document.getElementById('pi-opt-out').textContent = pi;
    setTimeout(done, 0);
});
            </code></pre>
            <a class="fragment no-burn" data-fragment-index="1" style="display: inline-block; margin-right: 10%"
               onclick="return runCode('better-pi3', 'pi-opt')" href="#">Ausführen</a>
            <div class="fragment no-burn" data-fragment-index="1" style="display: inline-block; width: 40%">
                <pre><code data-trim id="pi-opt-out">0</code></pre>
            </div>
        </section>
        <section>
            <h2>Viel besser!</h2>
            <p class="fragment no-burn" data-fragment-index="1">aber</p>
            <p class="fragment no-burn" data-fragment-index="2">Warum war <code>setTimeout(…,0)</code> so</p>
            <h2 class="fragment no-burn" data-fragment-index="2">langsam?</h2>
        </section>
    </section>

    <section data-title="setQuickTimeout">
        <section>
            <h3>
                Gibt es ein
            </h3>
            <h1>
                setQuickTimeout?
            </h1>
        </section>
        <section>
            <p>Browsers können <code>setTimeout</code> auf</p>
            <h2 class="fragment no-burn" data-fragment-index="1">>4ms</h2>
            <p class="fragment no-burn" data-fragment-index="1">beschränken!</p>
            <p class="fragment no-burn" data-fragment-index="2">(und <em>>1000ms</em> in inaktiven Tabs!)</p>
        </section>
        <section>
            <h2><code>setTimeout</code> im Browser</h2>
            <pre class="fragment no-burn" data-fragment-index="1"><code class="hljs js" id="timeout" data-trim contenteditable>
var startTime = performance.now();

function printTime() {
    document.getElementById('timeout-out').textContent +=
        (performance.now() - startTime) + '\n';
}

setTimeout(printTime, 0);
            </code></pre>
            <a class="fragment no-burn" data-fragment-index="1" style="display: inline-block; margin-right: 10%; margin-top: 2%"
               onclick="return runCode('timeout')" href="#">Ausführen</a>
            <div class="fragment no-burn" data-fragment-index="1" style="display: inline-block; width: 40%; vertical-align: top">
                <pre><code style="min-height: 1em" data-trim id="timeout-out"></code></pre>
            </div>
        </section>
        <section>
            <h2>Schneller als <code>setTimeout</code></h2>
            <pre class="fragment no-burn" data-fragment-index="1"><code class="hljs js" id="post-message" data-trim contenteditable>
var startTime = performance.now();

function printTime() {
    window.removeEventListener('message', printTime, true)
    document.getElementById('post-out').textContent +=
        (performance.now() - startTime) + '\n';
}

window.addEventListener('message', printTime, true);
window.postMessage('mymessage', '*');
            </code></pre>
            <a class="fragment no-burn" data-fragment-index="1" style="display: inline-block; margin-right: 10%; margin-top: 2%"
               onclick="return runCode('post-message')" href="#">Ausführen</a>
            <div class="fragment no-burn" data-fragment-index="1" style="display: inline-block; width: 40%; vertical-align: top">
                <pre><code style="min-height: 1em" data-trim id="post-out"></code></pre>
            </div>
        </section>
        <section>
            <h2>Gute Polyfills</h2>
            <ul>
                <li class="fragment no-burn"><a href="https://github.com/yuzujs/setImmediate">setimmediate</a></li>
                <li class="fragment no-burn"><a href="https://github.com/taylorhakes/setAsap">setasap</a></li>
            </ul>
        </section>
        <section>
            <p>aber</p>
            <p class="fragment no-burn">geht es</p>
            <h2 class="fragment no-burn">NOCH schneller?</h2>
        </section>
    </section>

    <section data-title="Web Worker">
        <section>
            <h1>
                Web Worker
            </h1>
            <h3>
                Wenn es mal wieder länger dauert
            </h3>
        </section>
        <section>
            <h2>Web Worker</h2>
            <ul>
                <li>arbeiten echt parallel in einem eigenen Thread!</li>
                <li>in allen modernen Browsern verfügbar</li>
                <li>striktes Sandboxing gegenüber anderen Threads</li>
                <li>Kommunikation über <code>postMessage(…)</code></li>
                <li>Nur Austausch von reinen Datenobjekten</li>
                <li>Kein Zugriff auf DOM oder <code>window</code></li>
            </ul>
            <p class="fragment no-burn">aber</p>
            <ul>
                <li>Worker können eigene Netzwerk-Requests absetzen</li>
            </ul>
        </section>
        <section>
            <h2>Einfaches Beispiel</h2>
            <pre><code class="hljs js" id="worker" data-trim contenteditable>
var worker = new Worker('workerFile.js');
worker.addEventListener('message', function(message) {
    console.log(message.data);
});

worker.postMessage('Hallo Worker!');
            </code></pre>
            <p class="fragment no-burn" data-fragment-index="1"><code>workerFile.js</code></p>
            <pre class="fragment no-burn" data-fragment-index="1"><code class="hljs js" data-trim>
self.addEventListener('message', function(message) {
  console.log('Received: ', message.data);
  for (var i = 0; i < 1000000000; i++) {
    if (i % 100000000 === 0) self.postMessage(i);
  }
});
            </code></pre>
            <a class="fragment no-burn" data-fragment-index="1" onclick="return runCode('worker')" href="#">Ausführen</a>
        </section>
        <section>

        </section>
    </section>

    <!-- Danke Slide -->
    <section>
        <section>
            <h1>Vielen Dank!</h1>

            <p>
                <a href="mailto:lukas@tngtech.com">lukas.taegert@tngtech.com</a><br>
            </p>
            <a href="http://www.tngtech.com"><img class="logo" src="img/tng.svg"></a>
        </section>
        <section data-markdown>
        </section>
    </section>

</body>
</html>